# 以太坊高级监控功能需求文档

## 项目概述

在现有的以太坊 MEV 监控工具基础上，新增四个高级监控功能模块，提升链上数据分析和预警能力。

## 功能模块

### 1. 清算事件监控 (Liquidation Monitor)

**目标用户**: DeFi 用户、套利者、风险管理者

**核心需求**:
- AC1.1: 监听主流借贷协议（Aave V3、Compound V3）的清算事件
- AC1.2: 记录清算详情（被清算地址、抵押品、债务、清算人、折扣比例）
- AC1.3: 计算清算利润（抵押品价值 - 债务 - Gas 成本）
- AC1.4: 大额清算（>100K USD）实时微信告警
- AC1.5: 生成每日清算统计报告（总清算量、平均折扣、热门资产）
- AC1.6: 支持自定义监控地址的健康度预警

**数据存储**:
- 清算事件表：记录所有清算交易
- 清算统计表：每日/每周汇总数据

### 2. MEV 深度监控升级 (MEV Deep Analytics)

**目标用户**: MEV 研究者、交易者、Bot 开发者

**核心需求**:
- AC2.1: 扩展 MEV 检测，记录详细利润数据（收入、成本、净利润）
- AC2.2: 识别并追踪 MEV Bot 地址，建立 Bot 档案
- AC2.3: 统计每日 MEV 收益排行榜（Top 10 Bots）
- AC2.4: 分析受害者损失，识别高风险交易模式
- AC2.5: 监控特定代币/池子的 MEV 活跃度
- AC2.6: 实时检测针对监控地址的三明治攻击前置交易
- AC2.7: 生成 MEV 趋势报告（攻击类型分布、成功率、Gas 竞争）

**数据存储**:
- MEV 交易详情表
- MEV Bot 档案表
- MEV 统计表


### 3. 钱包行为分析 (Wallet Behavior Analytics)

**目标用户**: 投资者、研究者、风险管理者

**核心需求**:
- AC3.1: 自动发现和追踪"聪明钱"地址（高胜率、高收益）
- AC3.2: 监控巨鲸地址（资产 > 1000 ETH）的交易行为
- AC3.3: 检测休眠地址唤醒（>1年未活动后首次交易）
- AC3.4: 分析地址交易模式（平均持仓时间、胜率、偏好代币）
- AC3.5: 集成 Etherscan/DeBank API 获取地址标签
- AC3.6: 当聪明钱/巨鲸买入新代币时实时告警
- AC3.7: 生成钱包行为报告（交易频率、资产分布、收益曲线）

**数据存储**:
- 监控钱包表：地址、标签、类型（聪明钱/巨鲸/普通）
- 钱包交易历史表
- 钱包统计表

### 4. 智能合约部署监控 - Meme 币分析 (Contract Deployment & Meme Coin Analyzer)

**目标用户**: 早期投资者、Meme 币猎人、安全研究者

**核心需求**:
- AC4.1: 监听新合约部署事件（to 地址为 null 的交易）
- AC4.2: 监听 Uniswap/Sushiswap Factory 的 PairCreated 事件
- AC4.3: 自动分析新代币合约（名称、符号、总供应量、持有者分布）
- AC4.4: 蜜罐检测（集成 Honeypot.is 或 GoPlus API）
- AC4.5: 风险评分（合约验证、流动性锁定、所有权、税率、持有者集中度）
- AC4.6: 检测危险信号（高税率、无法卖出、持有者过度集中）
- AC4.7: 低风险且有潜力的新币实时告警（风险评分 < 30，初始市值 < 100K）
- AC4.8: 生成新币日报（每日新增代币数、风险分布、推荐列表）

**数据存储**:
- 合约部署表
- 代币分析表
- 代币风险评分表

## 非功能需求

### 性能要求
- NFR1: 事件监听延迟 < 5 秒
- NFR2: 数据库查询响应时间 < 100ms
- NFR3: 支持并发监控 100+ 地址

### 可靠性要求
- NFR4: RPC 节点故障自动切换
- NFR5: 监控服务 99% 可用性
- NFR6: 数据持久化，防止丢失

### 可扩展性
- NFR7: 支持添加新的借贷协议监控
- NFR8: 支持添加新的 DEX 监控
- NFR9: 模块化设计，功能独立可插拔

## 技术约束

- 使用现有技术栈：Go 1.24+, go-ethereum, GORM, Zap
- 复用现有架构：scheduler, database, logger, utils
- 使用 Infura/Alchemy 作为 RPC 提供商
- 使用 PushPlus 作为告警通道
- 数据库：SQLite（可升级到 PostgreSQL）

## 优先级

1. **P0 (高优先级)**: 
   - 智能合约部署监控 - Meme 币分析（最有商业价值）
   - 清算事件监控（实用性强）

2. **P1 (中优先级)**:
   - MEV 深度监控升级（基于现有功能扩展）

3. **P2 (低优先级)**:
   - 钱包行为分析（需要更多数据积累）

## 成功标准

- 所有 AC 验收标准通过
- 单元测试覆盖率 > 70%
- 成功监控并告警至少 1 个真实事件
- 文档完整，包含使用示例
